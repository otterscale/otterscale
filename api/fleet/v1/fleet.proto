// TODO: Implement at version v0.9.0
edition = "2023";

package otterscale.fleet.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/otterscale/otterscale/api/fleet/v1;pb";

// FleetService manages a collection of Kubernetes clusters.
// Members are individual Kubernetes clusters that are part of the fleet.
service FleetService {
  // ListMembers lists all members (Kubernetes clusters) in the fleet.
  rpc ListMembers(ListMembersRequest) returns (ListMembersResponse);

  // ImportMember adds a new Kubernetes cluster to the fleet.
  rpc ImportMember(ImportMemberRequest) returns (Member);

  // UpdateMember updates the kubeconfig of an existing member in the fleet.
  rpc UpdateMember(UpdateMemberRequest) returns (Member);

  // DeleteMember removes a member (Kubernetes cluster) from the fleet.
  rpc DeleteMember(DeleteMemberRequest) returns (google.protobuf.Empty);
}

// Provider represents the underlying provider of the Kubernetes cluster.
enum Provider {
  PROVIDER_LOCAL   = 0;
  PROVIDER_RANCHER = 1;
}

// Distribution represents the Kubernetes distribution used by the cluster.
enum Distribution {
  DISTRIBUTION_UNSPECIFIED        = 0;
  DISTRIBUTION_CHARMED_KUBERNETES = 1;
  DISTRIBUTION_TALOS              = 2;
}

// Member represents a managed Kubernetes cluster in the fleet.
message Member {
  string                    uuid         = 1;
  string                    name         = 2;
  Provider                  provider     = 3;
  Distribution              distribution = 4;
  google.protobuf.Timestamp created_at   = 5;
  google.protobuf.Timestamp updated_at   = 6;
  repeated string           versions     = 7;
}

// ListMembersRequest is the request message for listing fleet members.
message ListMembersRequest {}

// ListMembersResponse contains a list of members in the fleet.
message ListMembersResponse {
  repeated Member members = 1;
}

// ImportMemberRequest adds a new Kubernetes cluster to the fleet.
message ImportMemberRequest {
  string       name         = 1;
  Provider     provider     = 2;
  Distribution distribution = 3;
  bytes        kubeconfig   = 4;
}

// UpdateMemberRequest updates the kubeconfig of an existing member.
message UpdateMemberRequest {
  string uuid       = 1;
  bytes  kubeconfig = 2;
}

// DeleteMemberRequest removes a member from the fleet.
message DeleteMemberRequest {
  string uuid = 1;
}