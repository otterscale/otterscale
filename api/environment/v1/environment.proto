edition = "2023";

package otterscale.environment.v1;

import "google/protobuf/empty.proto";

option go_package = "github.com/openhdc/otterscale/api/environment/v1;pb";

service EnvironmentService {
  rpc CheckHealth(CheckHealthRequest) returns (CheckHealthResponse);
  rpc WatchStatus(WatchStatusRequest) returns (stream WatchStatusResponse);
  rpc UpdateStatus(UpdateStatusRequest) returns (google.protobuf.Empty);
  rpc UpdateConfig(UpdateConfigRequest) returns (google.protobuf.Empty);
  rpc UpdateConfigHelmRepositories(UpdateConfigHelmRepositoriesRequest) returns (google.protobuf.Empty);
  rpc GetPrometheus(GetPrometheusRequest) returns (Prometheus);
}

message CheckHealthRequest {}

message CheckHealthResponse {
  enum Result {
    UNSPECIFIED = 0;
    OK = 11;
    NOT_INSTALLED = 21;
  }
  Result result = 1;
}

message WatchStatusRequest {}

message WatchStatusResponse {
  bool started = 1;
  bool finished = 2;
  string phase = 11;
  string message = 12;
}

message UpdateStatusRequest {
  string phase = 1;
  string message = 2;
}

message UpdateConfigRequest {
  string maas_url = 1;
  string maas_key = 2;
  string maas_version = 3;
  string juju_controller = 11;
  repeated string juju_controller_addresses = 12;
  string juju_username = 13;
  string juju_password = 14;
  string juju_ca_cert = 15;
  string juju_cloud_name = 21;
  string juju_cloud_region = 22;
  string juju_charmhub_api_url = 23;
  string micro_k8s_host = 31;
  string micro_k8s_token = 32;
}

message UpdateConfigHelmRepositoriesRequest {
  repeated string urls = 1;
}

message Prometheus {
  string endpoint = 1;
  string base_url = 2;
}

message GetPrometheusRequest {}